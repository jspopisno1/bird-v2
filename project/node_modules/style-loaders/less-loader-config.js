var ExtractTextPlugin = require('extract-text-webpack-plugin')

module.exports = {
    setup: function (loaders, opts) {
        var loader = {
            test: /\.less$/,
            exclude: [
                /\.mod\.less$/
            ]
        }

        var modLoader = {
            test: /\.mod\.less$/
        }

        if (opts.devMode == 'dev') {
            loader.loaders = [
                'style-loader',
                'css-loader?localIdentName=[path][name]__[local]___[hash:base64:5]',
                'autoprefixer?browsers=last 2 version',
                'less-loader'
            ]

            modLoader.loaders = [
                'style-loader',
                'css-loader?modules&localIdentName=[path][name]__[local]___[hash:base64:5]',
                'autoprefixer?browsers=last 2 version',
                'less-loader'
            ]
        } else {
            loader.loader = ExtractTextPlugin.extract(
                'style-loader',
                [
                    'css-loader?localIdentName=[local]___[hash:base64:5]',
                    'autoprefixer?browsers=last 2 version',
                    'less-loader'
                ])

            modLoader.loader = ExtractTextPlugin.extract(
                'style-loader',
                [
                    'css-loader?modules&localIdentName=[local]___[hash:base64:5]',
                    'autoprefixer?browsers=last 2 version',
                    'less-loader'
                ])
        }

        loaders.push(loader)
        loaders.push(modLoader)
    }
}